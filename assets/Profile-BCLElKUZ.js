import{c as U,u as O,o as $,a as q,r as l,j as e,h as f,m as c,v as G,s as J,e as K,g as F}from"./index-DW35rIVo.js";import{I as m}from"./input-f5AW0FoI.js";import{L as d}from"./label-C59nEV0B.js";import{C as j,c as g,a as y,b}from"./card-CcSMtKMr.js";import{A as Q,a as W,b as X}from"./avatar-BGq7Gosz.js";import{S as P}from"./separator-JxeVl68w.js";import{u as Y,C as Z,E as C,p as I}from"./profileStore-CiK1q8As.js";import{A as ee}from"./arrow-left-DY4_iDT3.js";import{U as se}from"./user-CleuBYpp.js";import{L as k}from"./loader-circle-BnlNvwYj.js";import"./index-DN7uoSTJ.js";import"./index-DUzm_Fz5.js";import"./index-MnEzf-Ac.js";import"./index-D2xAthOw.js";const ae=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],_=U("eye-off",ae);const te=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],re=U("lock",te);function ve(){const V=O(),{toast:i}=$(),{profile:s,isLoading:S,loadProfile:v,updateProfile:M}=Y(),{user:w}=q(),x=l.useRef(null),[o,h]=l.useState({email:"",signature:""}),[t,u]=l.useState({oldPassword:"",newPassword:"",confirmPassword:""}),[r,N]=l.useState({old:!1,new:!1,confirm:!1}),[A,z]=l.useState(!1),[D,L]=l.useState(!1);l.useEffect(()=>{v().catch(console.error)},[v]),l.useEffect(()=>{s&&h({email:s.user_email||"",signature:s.user_signature||""})},[s]);const R=async a=>{a.preventDefault();try{await M(o),i({title:"成功",description:"个人资料已更新"})}catch(n){i({title:"更新失败",description:n instanceof Error?n.message:"请稍后重试",variant:"destructive"})}},T=()=>{x.current?.click()},B=async a=>{const n=a.target.files?.[0];if(n){z(!0);try{await I.uploadAvatar(n),await v(),i({title:"成功",description:"头像上传成功"})}catch(E){i({title:"上传失败",description:E instanceof Error?E.message:"请稍后重试",variant:"destructive"})}finally{z(!1),x.current&&(x.current.value="")}}},H=async a=>{if(a.preventDefault(),t.newPassword!==t.confirmPassword){i({title:"错误",description:"两次输入的新密码不一致",variant:"destructive"});return}if(t.newPassword.length<6){i({title:"错误",description:"新密码长度至少 6 位",variant:"destructive"});return}L(!0);try{await I.changePassword({old_password:t.oldPassword,new_password:t.newPassword}),i({title:"成功",description:"密码修改成功"}),u({oldPassword:"",newPassword:"",confirmPassword:""})}catch(n){i({title:"修改失败",description:n instanceof Error?n.message:"旧密码可能不正确",variant:"destructive"})}finally{L(!1)}},p=s?.user_nickname||w?.nickname||"用户";return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-6 py-8 max-w-4xl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(f,{variant:"ghost",onClick:()=>V("/"),className:"gap-2",children:[e.jsx(ee,{size:18}),"返回首页"]})}),e.jsxs(c.div,{variants:G,initial:"hidden",animate:"visible",className:"mb-8 flex items-center gap-4",children:[e.jsx(se,{size:32,className:"text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold",children:"个人资料"}),e.jsx("p",{className:"text-muted-foreground",children:"管理您的个人信息"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(c.div,{variants:J,initial:"hidden",animate:"visible",transition:{delay:.1},children:e.jsx(j,{className:"lg:col-span-1",children:e.jsx(g,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs(Q,{className:"h-32 w-32",children:[e.jsx(W,{src:s?.user_avatar_url||"",alt:p}),e.jsx(X,{className:"bg-gradient-to-br from-blue-500 to-purple-500 text-white text-3xl",children:p[0]?.toUpperCase()||"U"})]}),e.jsx("button",{onClick:T,disabled:A,className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",children:A?e.jsx(k,{className:"h-8 w-8 text-white animate-spin"}):e.jsx(Z,{className:"h-8 w-8 text-white"})})]}),e.jsx("input",{ref:x,type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",className:"hidden",onChange:B}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"点击头像更换"}),e.jsx("h3",{className:"text-xl font-semibold mt-4",children:p}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["ID: ",s?.user_id||w?.user_id]})]})})})}),e.jsx(c.div,{variants:K,initial:"hidden",animate:"visible",transition:{delay:.1},className:"lg:col-span-2",children:e.jsxs(j,{children:[e.jsx(y,{children:e.jsx(b,{children:"基本信息"})}),e.jsx(g,{children:e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"nickname",children:"昵称"}),e.jsx(m,{id:"nickname",value:p,disabled:!0,placeholder:"您的昵称",className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"昵称暂不支持修改"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"email",children:"邮箱"}),e.jsx(m,{id:"email",type:"email",value:o.email,onChange:a=>h({...o,email:a.target.value}),placeholder:"your@email.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"signature",children:"个性签名"}),e.jsx("textarea",{id:"signature",value:o.signature,onChange:a=>h({...o,signature:a.target.value}),placeholder:"介绍一下自己吧...",className:"flex min-h-[120px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",maxLength:200}),e.jsxs("p",{className:"text-xs text-muted-foreground text-right",children:[o.signature.length,"/200"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(f,{type:"submit",disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"保存中..."]}):"保存更改"}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>h({email:s?.user_email||"",signature:s?.user_signature||""}),children:"重置"})]})]})})]})})]}),e.jsx(c.div,{variants:F,initial:"hidden",animate:"visible",transition:{delay:.2},children:e.jsxs(j,{className:"mt-6",children:[e.jsx(y,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(re,{size:20}),"修改密码"]})}),e.jsx(g,{children:e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"oldPassword",children:"当前密码"}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{id:"oldPassword",type:r.old?"text":"password",value:t.oldPassword,onChange:a=>u({...t,oldPassword:a.target.value}),placeholder:"输入当前密码"}),e.jsx("button",{type:"button",onClick:()=>N({...r,old:!r.old}),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:r.old?e.jsx(_,{size:16}):e.jsx(C,{size:16})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"newPassword",children:"新密码"}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{id:"newPassword",type:r.new?"text":"password",value:t.newPassword,onChange:a=>u({...t,newPassword:a.target.value}),placeholder:"输入新密码（至少6位）"}),e.jsx("button",{type:"button",onClick:()=>N({...r,new:!r.new}),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:r.new?e.jsx(_,{size:16}):e.jsx(C,{size:16})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"confirmPassword",children:"确认新密码"}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{id:"confirmPassword",type:r.confirm?"text":"password",value:t.confirmPassword,onChange:a=>u({...t,confirmPassword:a.target.value}),placeholder:"再次输入新密码"}),e.jsx("button",{type:"button",onClick:()=>N({...r,confirm:!r.confirm}),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:r.confirm?e.jsx(_,{size:16}):e.jsx(C,{size:16})})]})]})]}),e.jsx(f,{type:"submit",disabled:D||!t.oldPassword||!t.newPassword||!t.confirmPassword,children:D?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"修改中..."]}):"修改密码"})]})})]})}),e.jsx(c.div,{variants:F,initial:"hidden",animate:"visible",transition:{delay:.3},children:e.jsxs(j,{className:"mt-6",children:[e.jsx(y,{children:e.jsx(b,{children:"账户信息"})}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"用户 ID"}),e.jsx("span",{className:"font-semibold",children:s?.user_id||w?.user_id})]}),e.jsx(P,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"账户类型"}),e.jsx("span",{className:"font-semibold",children:s?.admin==="true"?"管理员":"普通用户"})]}),e.jsx(P,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"注册时间"}),e.jsx("span",{className:"font-semibold",children:s?.created_at?new Date(s.created_at).toLocaleDateString("zh-CN"):"-"})]}),e.jsx(P,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"最后更新"}),e.jsx("span",{className:"font-semibold",children:s?.updated_at?new Date(s.updated_at).toLocaleDateString("zh-CN"):"-"})]})]})]})})]})})}export{ve as default};

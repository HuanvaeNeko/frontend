import{c as w,n as h,a as d}from"./index-DW35rIVo.js";const g=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],p=w("copy",g),a=`${h()}/api/webrtc`,i=()=>{const e=d.getState().accessToken;return{"Content-Type":"application/json",...e?{Authorization:`Bearer ${e}`}:{}}},l=async(e,o={})=>{const r=d.getState();if(r.checkTokenExpiry()&&r.refreshToken)try{await r.refreshAccessToken()}catch(n){console.error("Failed to refresh token:",n)}const s=i();let t=await fetch(e,{...o,headers:{...s,...o.headers}});if(t.status===401&&r.refreshToken)try{await r.refreshAccessToken();const n=i();t=await fetch(e,{...o,headers:{...n,...o.headers}})}catch(n){throw console.error("Token refresh failed, redirecting to login"),r.clearAuth(),window.location.href="/login",n}return t},c={getIceServers:async e=>{console.log("ðŸŒ èŽ·å– ICE æœåŠ¡å™¨é…ç½®");const o=new URLSearchParams;e&&o.set("region",e);const r=o.toString()?`${a}/ice-servers?${o}`:`${a}/ice-servers`,s=await l(r,{method:"GET"});if(!s.ok){const n=await s.json().catch(()=>({error:"èŽ·å– ICE æœåŠ¡å™¨é…ç½®å¤±è´¥"}));throw new Error(n.error?.message||n.error||"èŽ·å– ICE æœåŠ¡å™¨é…ç½®å¤±è´¥")}const t=await s.json();return console.log("âœ… ICE æœåŠ¡å™¨é…ç½®èŽ·å–æˆåŠŸ, è¿‡æœŸæ—¶é—´:",t.data.expires_at),t.data.ice_servers},createRoom:async(e={})=>{console.log("ðŸ  åˆ›å»º WebRTC æˆ¿é—´:",e.name);const o=await l(`${a}/rooms`,{method:"POST",body:JSON.stringify(e)});if(!o.ok){const s=await o.json().catch(()=>({error:"åˆ›å»ºæˆ¿é—´å¤±è´¥"}));throw new Error(s.error||s.message||"åˆ›å»ºæˆ¿é—´å¤±è´¥")}const r=await o.json();return console.log("âœ… æˆ¿é—´åˆ›å»ºæˆåŠŸ:",r.data.room_id),r.data},joinRoom:async(e,o)=>{console.log("ðŸšª åŠ å…¥æˆ¿é—´:",e);const r=await fetch(`${a}/rooms/${e}/join`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok){const t=await r.json().catch(()=>({error:"åŠ å…¥æˆ¿é—´å¤±è´¥"}));throw r.status===401?new Error("å¯†ç é”™è¯¯"):r.status===404?new Error("æˆ¿é—´ä¸å­˜åœ¨"):r.status===400?new Error(t.error||t.message||"æˆ¿é—´å·²è¿‡æœŸæˆ–å·²æ»¡"):new Error(t.error||t.message||"åŠ å…¥æˆ¿é—´å¤±è´¥")}const s=await r.json();return console.log("âœ… åŠ å…¥æˆ¿é—´æˆåŠŸ, å‚ä¸Žè€…ID:",s.data.participant_id),s.data},createSignalingConnection:(e,o)=>{const s=`${h().replace(/^http/,"ws")}/ws/webrtc/rooms/${e}?token=${o}`;console.log("ðŸ”Œ è¿žæŽ¥ä¿¡ä»¤ WebSocket:",e);const t=new WebSocket(s);return t.onopen=()=>{console.log("âœ… ä¿¡ä»¤è¿žæŽ¥å·²å»ºç«‹")},t.onclose=n=>{console.log("ðŸ”Œ ä¿¡ä»¤è¿žæŽ¥å·²æ–­å¼€:",n.code,n.reason)},t.onerror=n=>{console.error("âŒ ä¿¡ä»¤è¿žæŽ¥é”™è¯¯:",n)},t},sendSignaling:(e,o)=>{e.readyState===WebSocket.OPEN?e.send(JSON.stringify(o)):console.error("WebSocket æœªè¿žæŽ¥, æ¶ˆæ¯å‘é€å¤±è´¥")},sendOffer:(e,o,r)=>{c.sendSignaling(e,{type:"offer",to:o,sdp:r})},sendAnswer:(e,o,r)=>{c.sendSignaling(e,{type:"answer",to:o,sdp:r})},sendCandidate:(e,o,r)=>{c.sendSignaling(e,{type:"candidate",to:o,candidate:r})},leaveRoom:e=>{c.sendSignaling(e,{type:"leave"})}};export{p as C,c as w};

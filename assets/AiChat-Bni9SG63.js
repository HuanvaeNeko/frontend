import{c as I,u as T,o as M,a as P,r as c,j as e,h as p,B as j}from"./index-DW35rIVo.js";import{u as K,W as A}from"./apiConfig-BgQ7GW6n.js";import{A as B}from"./arrow-left-DY4_iDT3.js";import{D as O,S as F}from"./send-B5Dqmo0T.js";import{S as k}from"./settings-CSPE_HBJ.js";import{U as _}from"./user-CleuBYpp.js";import{L as C}from"./loader-circle-BnlNvwYj.js";const V=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],q=I("circle-alert",V);const H=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],W=I("trash",H);function se(){const z=T(),{toast:S}=M(),{accessToken:y}=P(),r=K(),[u,h]=c.useState([{role:"assistant",content:"您好！我是 AI 聊天助手。有什么可以帮助您的吗？",timestamp:Date.now()}]),[d,m]=c.useState(""),[i,b]=c.useState(!1),[N,f]=c.useState(null),v=c.useRef(null),g=c.useRef(null),$=()=>{v.current?.scrollIntoView({behavior:"smooth"})};c.useEffect(()=>{$()},[u]);const w=s=>new Date(s).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),L=async s=>{const o=r.useCustomApi?r.aiApiUrl:`${r.aiApiUrl}`;g.current=new AbortController;try{const t={"Content-Type":"application/json"};y&&(t.Authorization=`Bearer ${y}`),r.useCustomApi&&r.aiApiKey&&(t["X-API-Key"]=r.aiApiKey);const a=u.map(x=>({role:x.role,content:x.content}));a.push({role:"user",content:s});const l=await fetch(o,{method:"POST",headers:t,body:JSON.stringify({messages:a,message:s,stream:!1}),signal:g.current.signal});if(!l.ok){const x=await l.json().catch(()=>({}));throw new Error(x.error||x.message||`请求失败 (${l.status})`)}const n=await l.json();return n.content||n.message||n.response||n.reply||n.choices?.[0]?.message?.content||"收到您的消息，但我暂时无法回复。"}catch(t){throw t instanceof Error&&t.name==="AbortError"?new Error("请求已取消"):t}},R=async()=>{if(!d.trim()||i)return;const s={role:"user",content:d,timestamp:Date.now()};h(t=>[...t,s]);const o=d;m(""),b(!0),f(null);try{const a={role:"assistant",content:await L(o),timestamp:Date.now()};h(l=>[...l,a])}catch(t){const a=t instanceof Error?t.message:"发送失败，请稍后重试";f(a);const l={role:"assistant",content:`抱歉，发生了错误：${a}

您可以尝试：
1. 检查网络连接
2. 在设置中配置正确的 API 地址
3. 稍后重试`,timestamp:Date.now()};h(n=>[...n,l])}finally{b(!1)}},D=()=>{g.current&&(g.current.abort(),b(!1))},U=()=>{confirm("确定要清空聊天记录吗？")&&(h([{role:"assistant",content:"聊天记录已清空。有什么可以帮助您的吗？",timestamp:Date.now()}]),f(null))},E=()=>{const s=u.map(l=>{const n=l.role==="user"?"我":"AI";return`[${w(l.timestamp)}] ${n}: ${l.content}`}).join(`

`),o=new Blob([s],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(o),a=document.createElement("a");a.href=t,a.download=`ai-chat-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),S({title:"导出成功",description:"聊天记录已保存"})};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100 flex flex-col",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-xl border-b border-gray-200 shadow-sm sticky top-0 z-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>z("/"),children:e.jsx(B,{size:20})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary to-purple-600 flex items-center justify-center",children:e.jsx(j,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg",children:"AI 聊天助手"}),e.jsxs("p",{className:"text-xs text-green-600 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"在线"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(p,{variant:"ghost",size:"sm",onClick:E,className:"gap-2",children:[e.jsx(O,{size:18}),"导出"]}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:U,className:"gap-2",children:[e.jsx(W,{size:18}),"清空"]}),e.jsx("label",{htmlFor:"settings-modal",children:e.jsx(p,{variant:"ghost",size:"sm",className:"gap-2",asChild:!0,children:e.jsxs("span",{children:[e.jsx(k,{size:18}),"设置"]})})})]})]})}),N&&e.jsx("div",{className:"max-w-4xl mx-auto w-full px-4 py-2",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 flex items-center gap-2 text-sm text-red-600",children:[e.jsx(q,{size:16}),N,e.jsx("button",{onClick:()=>f(null),className:"ml-auto text-red-400 hover:text-red-600",children:"✕"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-4",children:[u.map((s,o)=>e.jsx("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex gap-3 max-w-[80%] ${s.role==="user"?"flex-row-reverse":""}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center ${s.role==="user"?"bg-gradient-to-br from-blue-500 to-purple-500":"bg-gradient-to-br from-primary to-purple-600"}`,children:s.role==="user"?e.jsx(_,{size:20,className:"text-white"}):e.jsx(j,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center gap-2 mb-1 ${s.role==="user"?"justify-end":""}`,children:[s.role==="assistant"&&e.jsx(A,{size:12,className:"text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:s.role==="user"?"我":"AI 助手"}),e.jsx("time",{className:"text-xs text-gray-400",children:w(s.timestamp)})]}),e.jsx("div",{className:`rounded-2xl px-4 py-3 shadow-sm ${s.role==="user"?"bg-primary text-primary-foreground":"bg-white border border-gray-200"}`,children:e.jsx("div",{className:"whitespace-pre-wrap",children:s.content})})]})]})},o)),i&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"flex gap-3 max-w-[80%]",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary to-purple-600 flex items-center justify-center animate-pulse",children:e.jsx(j,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(A,{size:12,className:"text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"AI 助手"})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-2xl px-4 py-3 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm text-gray-500",children:"AI 正在思考..."}),e.jsx("button",{onClick:D,className:"text-xs text-red-500 hover:text-red-600 ml-2",children:"取消"})]})})]})]})}),e.jsx("div",{ref:v})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-xl border-t border-gray-200 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("form",{onSubmit:s=>{s.preventDefault(),R()},children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:d,onChange:s=>m(s.target.value),placeholder:"输入您的问题...",className:"w-full px-4 py-3 pr-20 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",disabled:i,maxLength:2e3}),e.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-xs text-gray-400",children:[d.length,"/2000"]})]}),e.jsx(p,{type:"submit",disabled:!d.trim()||i,className:"px-6 gap-2",children:i?e.jsx(C,{className:"h-5 w-5 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(F,{size:18}),"发送"]})})]})}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>m("你好，请介绍一下自己"),className:"px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded-full transition-colors",disabled:i,children:"介绍自己"}),e.jsx("button",{onClick:()=>m("你能帮我做什么？"),className:"px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded-full transition-colors",disabled:i,children:"功能说明"}),e.jsx("button",{onClick:()=>m("推荐一些有趣的话题"),className:"px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded-full transition-colors",disabled:i,children:"话题推荐"}),e.jsx("button",{onClick:()=>m("帮我写一段代码"),className:"px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded-full transition-colors",disabled:i,children:"写代码"})]})]})}),e.jsx("input",{type:"checkbox",id:"settings-modal",className:"modal-toggle hidden"}),e.jsxs("div",{className:"modal hidden peer-checked:flex fixed inset-0 z-50 items-center justify-center bg-black/50",id:"modal-backdrop",children:[e.jsx("label",{htmlFor:"settings-modal",className:"absolute inset-0"}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-lg w-full mx-4 relative z-10 shadow-xl",children:[e.jsxs("h3",{className:"font-bold text-xl mb-6 flex items-center gap-2",children:[e.jsx(k,{size:20,className:"text-primary"}),"API 配置"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-medium",children:"使用自定义 API"}),e.jsx("p",{className:"text-xs text-gray-500",children:"启用后可配置自己的 AI 服务"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.useCustomApi,onChange:s=>r.setApiConfig({useCustomApi:s.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"AI API URL"}),e.jsx("input",{type:"text",value:r.aiApiUrl,onChange:s=>r.setApiConfig({aiApiUrl:s.target.value}),placeholder:"http://localhost:8080/api/chat",disabled:!r.useCustomApi,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary disabled:bg-gray-100 disabled:text-gray-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"AI API Key"}),e.jsx("input",{type:"password",value:r.aiApiKey,onChange:s=>r.setApiConfig({aiApiKey:s.target.value}),placeholder:"输入 API Key（可选）",disabled:!r.useCustomApi,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary disabled:bg-gray-100 disabled:text-gray-400"})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx("button",{onClick:()=>r.resetToDefault(),className:"flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50 transition-colors",children:"重置"}),e.jsx("label",{htmlFor:"settings-modal",className:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-center cursor-pointer",children:"完成"})]})]})]}),e.jsx("style",{children:`
        .modal-toggle:checked ~ .modal {
          display: flex !important;
        }
      `})]})}export{se as default};

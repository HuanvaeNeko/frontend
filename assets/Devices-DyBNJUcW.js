import{c as _,u as S,o as T,a as E,r,j as e,h as i,m,v as R,R as P,T as y,b as $,d as F,G as C}from"./index-DW35rIVo.js";import{C as x,c as u}from"./card-CcSMtKMr.js";import{R as O,T as W,P as q,O as B,C as G,a as V,D as H,b as J,A as K}from"./index-Cs5iciTb.js";import{A as Q}from"./arrow-left-DY4_iDT3.js";import{L as b}from"./laptop-E1jxJVFi.js";import{L as w}from"./loader-circle-BnlNvwYj.js";import{C as U,M as X}from"./monitor-eChx64j5.js";import"./index-CsyBV8c4.js";import"./index-D2xAthOw.js";import"./index-DUzm_Fz5.js";import"./index-DwyAMUi7.js";import"./Combination-b0v2E6SL.js";import"./index-MnEzf-Ac.js";const Y=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Z=_("map-pin",Y);const I=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],ee=_("smartphone",I);function he(){const h=S(),{toast:a}=T(),{clearAuth:k}=E(),[f,D]=r.useState([]),[n,p]=r.useState(!0),[j,g]=r.useState(null),l=async()=>{p(!0);try{const s=await C.getDevices(),t=s.devices||s.data?.devices||[];D(Array.isArray(t)?t:[])}catch(s){console.error("加载设备列表失败:",s),a({title:"加载失败",description:s instanceof Error?s.message:"无法获取设备列表",variant:"destructive"})}finally{p(!1)}};r.useEffect(()=>{l()},[]);const z=async(s,t)=>{g(s);try{await C.revokeDevice(s),t?(a({title:"已退出登录",description:"当前设备已被移除，请重新登录"}),k(),h("/login")):(a({title:"成功",description:"设备已移除"}),await l())}catch(c){a({title:"移除失败",description:c instanceof Error?c.message:"无法移除设备",variant:"destructive"})}finally{g(null)}},L=s=>{const t=s.toLowerCase();return t.includes("mobile")||t.includes("android")||t.includes("iphone")||t.includes("ipad")?ee:t.includes("mac")||t.includes("windows")||t.includes("linux")?b:X},A=s=>s.includes("Chrome")?s.includes("Windows")?"Windows Chrome":s.includes("Mac")?"Mac Chrome":s.includes("Linux")?"Linux Chrome":s.includes("Android")?"Android Chrome":"Chrome 浏览器":s.includes("Firefox")?"Firefox 浏览器":s.includes("Safari")&&!s.includes("Chrome")?"Safari 浏览器":s.includes("Edge")?"Edge 浏览器":s.length>30?s.substring(0,30)+"...":s,M=s=>{const t=new Date(s),o=new Date().getTime()-t.getTime(),d=Math.floor(o/6e4),N=Math.floor(o/36e5),v=Math.floor(o/864e5);return d<1?"刚刚":d<60?`${d} 分钟前`:N<24?`${N} 小时前`:v<7?`${v} 天前`:t.toLocaleDateString("zh-CN")};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-6 py-8 max-w-4xl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(i,{variant:"ghost",onClick:()=>h("/"),className:"gap-2",children:[e.jsx(Q,{size:18}),"返回首页"]})}),e.jsxs(m.div,{variants:R,initial:"hidden",animate:"visible",className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(b,{size:32,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold",children:"设备管理"}),e.jsx("p",{className:"text-muted-foreground",children:"管理您的登录设备"})]})]}),e.jsxs(i,{variant:"outline",onClick:l,disabled:n,className:"gap-2",children:[e.jsx(P,{size:16,className:n?"animate-spin":""}),"刷新"]})]}),n?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(w,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):f.length===0?e.jsx(x,{children:e.jsxs(u,{className:"py-10 text-center text-muted-foreground",children:[e.jsx(y,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"暂无设备信息"})]})}):e.jsx(m.div,{variants:$,initial:"hidden",animate:"visible",className:"space-y-4",children:f.map(s=>{const t=L(s.device_info);return e.jsx(m.div,{variants:F,children:e.jsx(x,{children:e.jsx(u,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsx(t,{size:32,className:"text-blue-500"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[A(s.device_info),s.is_current&&e.jsx("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded-full",children:"当前设备"})]}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground mt-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{size:14}),"IP: ",s.ip_address||"未知"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{size:14}),"最后活动: ",M(s.last_active_at)]}),e.jsxs("p",{className:"text-xs",children:["登录时间: ",new Date(s.created_at).toLocaleString("zh-CN")]})]})]})]}),e.jsxs(O,{children:[e.jsx(W,{asChild:!0,children:e.jsx(i,{variant:s.is_current?"outline":"destructive",disabled:j===s.device_id,children:j===s.device_id?e.jsx(w,{className:"h-4 w-4 animate-spin"}):s.is_current?"退出登录":"移除"})}),e.jsxs(q,{children:[e.jsx(B,{className:"fixed inset-0 bg-black/50 z-50"}),e.jsxs(G,{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-lg p-6 w-full max-w-md shadow-xl z-50",children:[e.jsx(V,{className:"text-lg font-semibold mb-2",children:s.is_current?"确认退出登录？":"确认移除此设备？"}),e.jsx(H,{className:"text-sm text-muted-foreground mb-4",children:s.is_current?"退出后需要重新登录才能继续使用":"移除后该设备将无法继续访问，需要重新登录"}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(J,{asChild:!0,children:e.jsx(i,{variant:"outline",children:"取消"})}),e.jsx(K,{asChild:!0,children:e.jsx(i,{variant:"destructive",onClick:()=>z(s.device_id,s.is_current),children:"确认"})})]})]})]})]})]})})})},s.device_id)})}),e.jsx(x,{className:"mt-6",children:e.jsx(u,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(y,{size:20,className:"text-yellow-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"安全提示"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"定期检查您的登录设备，如发现异常设备请立即移除并修改密码。 建议在公共设备上使用后及时退出登录。"})]})]})})})]})})}export{he as default};

# 🚀 HuanVae Chat 前端开发路线图

参考线上测试版: https://web.huanvae.cn/

## 📋 当前状态分析

### ✅ 已完成
- [x] API 接口层完整实现
- [x] 基础页面框架（Home/Login/Register）
- [x] 路由配置
- [x] 认证状态管理
- [x] UI 组件库（shadcn/ui）
- [x] 动画效果（Framer Motion）

### 🔄 需要开发的核心功能

## 一、主界面重构（对标线上版本）

### 1.1 统一聊天界面 ⭐ 高优先级
**参考**: 线上版左侧会话列表 + 右侧聊天窗口布局

**需要实现**:
- [ ] 三栏布局
  - 左栏: 功能切换（好友/新朋友/已发送 | 我的群聊/群邀请 | 我的文件/上传文件 | WebRTC）
  - 中栏: 会话列表/好友列表/群聊列表/文件列表
  - 右栏: 聊天窗口/详细信息

- [ ] 会话列表组件
  - 显示好友/群聊会话
  - 未读消息数量徽章
  - 最后一条消息预览
  - 时间显示

- [ ] 聊天窗口组件
  - 消息列表（时间戳分页）
  - 输入框（支持表情/文件/图片）
  - 文件拖拽上传
  - 消息状态（发送中/已送达/失败）
  - 撤回/删除消息

### 1.2 好友管理 ⭐ 高优先级
**参考**: 线上版好友功能

**需要实现**:
- [ ] 好友列表
  - 显示头像/昵称/在线状态
  - 搜索好友
  - 点击开始聊天

- [ ] 添加好友弹窗
  - 输入用户ID
  - 验证消息
  - 发送请求

- [ ] 新朋友标签
  - 待处理的好友请求
  - 同意/拒绝按钮
  - 请求理由显示

- [ ] 已发送标签
  - 已发送的好友请求
  - 请求状态（待处理/已同意/已拒绝）

### 1.3 群聊管理 ⭐ 高优先级
**参考**: 线上版群聊功能

**需要实现**:
- [ ] 我的群聊列表
  - 群头像/群名称
  - 成员数量
  - 最后消息预览
  - 未读数量

- [ ] 创建群聊弹窗
  - 群名称
  - 群描述
  - 加群方式选择（开放加入/需要审批/仅邀请/仅管理员邀请/禁止加入）

- [ ] 群聊详情侧边栏
  - 群信息展示
  - 成员列表
  - 群公告
  - 邀请成员
  - 生成邀请码
  - 群设置（仅管理员）

- [ ] 群邀请标签
  - 收到的群邀请
  - 接受/拒绝按钮

- [ ] 邀请码功能
  - 生成邀请码弹窗
  - 使用邀请码加入弹窗

- [ ] 群公告管理
  - 发布公告
  - 公告列表
  - 置顶公告

### 1.4 文件管理 ⭐ 中优先级
**参考**: 线上版文件功能

**需要实现**:
- [ ] 我的文件标签
  - 文件列表（网格/列表视图）
  - 文件类型筛选
  - 文件搜索
  - 文件详情（大小/上传时间）
  - 下载/删除操作

- [ ] 上传文件标签
  - 拖拽上传区域
  - 文件选择
  - 存储位置选择（个人文件/发送给好友/发送到群聊）
  - 目标选择（好友/群聊列表）
  - 强制上传开关（跳过秒传）
  - 上传进度显示
  - 分片上传支持
  - 秒传提示

### 1.5 WebRTC 视频通话 ⭐ 高优先级
**参考**: 线上版 WebRTC 功能

**需要实现**:
- [ ] WebRTC 主页
  - 功能介绍卡片
  - 创建房间按钮
  - 加入房间按钮

- [ ] 创建房间弹窗
  - 房间名称（可选）
  - 房间密码（可选，不填自动生成）
  - 最大人数选择（2/5/10/20人）
  - 有效期选择（30分钟/1小时/2小时/6小时）

- [ ] 加入房间弹窗
  - 房间号输入
  - 密码输入
  - 昵称输入（可选）

- [ ] 当前房间信息
  - 房间号显示 + 复制按钮
  - 密码显示 + 复制按钮
  - 分享链接生成 + 复制按钮
  - 复制全部信息按钮
  - 离开房间按钮

- [ ] 视频通话界面
  - 本地视频预览
  - 远程视频展示（网格布局）
  - 控制栏
    - 🎤 静音/取消静音
    - 📹 开启/关闭摄像头
    - 🖥️ 屏幕共享
    - 📞 挂断
    - 👥 参与者列表
    - 🔗 分享链接
  - 参与者列表侧边栏
    - 参与者昵称
    - 在线状态
    - 音频/视频状态

## 二、个人中心完善

### 2.1 个人资料页 ⭐ 中优先级
**参考**: 线上版个人资料弹窗

**需要实现**:
- [ ] 头像展示 + 更换功能
  - 头像上传（最大10MB）
  - 支持格式：jpg/png/gif/webp
  - 裁剪预览

- [ ] 基本信息编辑
  - 用户ID（不可编辑）
  - 昵称
  - 邮箱
  - 个性签名

- [ ] 修改密码区域
  - 旧密码输入
  - 新密码输入
  - 确认新密码
  - 密码强度提示

### 2.2 设置页 ⭐ 低优先级
**参考**: 线上版设置弹窗

**需要实现**:
- [ ] 设备管理
  - 登录设备列表
  - 设备信息（设备名/IP/登录时间）
  - 当前设备标识
  - 删除设备按钮

- [ ] 文件缓存管理
  - 缓存大小统计
  - 刷新统计按钮
  - 清空缓存按钮

- [ ] 关于信息
  - 应用名称
  - 版本号
  - 技术栈说明

## 三、消息功能实现

### 3.1 私聊消息 ⭐ 高优先级

**需要实现**:
- [ ] 消息类型支持
  - [x] 文本消息
  - [ ] 图片消息（预览/下载）
  - [ ] 视频消息（播放/下载）
  - [ ] 文件消息（下载）

- [ ] 消息操作
  - [ ] 复制消息
  - [ ] 删除消息（软删除）
  - [ ] 撤回消息（2分钟内）
  - [ ] 转发消息

- [ ] 消息状态
  - [ ] 发送中
  - [ ] 已送达
  - [ ] 失败（重试）
  - [ ] 已撤回

- [ ] 时间戳分页
  - [ ] 滚动到顶部自动加载更多
  - [ ] 加载动画
  - [ ] 到达底部提示

### 3.2 群聊消息 ⭐ 高优先级

**需要实现**:
- [ ] 群消息显示
  - [ ] 发送者昵称/群昵称
  - [ ] 发送者头像
  - [ ] 消息内容
  - [ ] 消息类型（文本/图片/视频/文件/系统）

- [ ] 回复功能
  - [ ] 引用消息
  - [ ] 显示被回复消息

- [ ] 群消息特殊功能
  - [ ] @成员（输入@触发成员列表）
  - [ ] 管理员撤回任意消息

## 四、实时通信

### 4.1 WebSocket 连接 ⭐ 高优先级

**需要实现**:
- [ ] WebSocket 连接管理
  - [ ] 自动连接
  - [ ] 断线重连
  - [ ] 心跳保活
  - [ ] 连接状态显示

- [ ] 消息推送
  - [ ] 新消息实时显示
  - [ ] 消息送达确认
  - [ ] 好友请求通知
  - [ ] 群邀请通知
  - [ ] 系统通知

- [ ] 在线状态
  - [ ] 好友在线/离线状态
  - [ ] 最后在线时间

### 4.2 消息通知 ⭐ 中优先级

**需要实现**:
- [ ] 桌面通知
  - [ ] 新消息通知
  - [ ] 通知点击跳转
  - [ ] 通知权限申请

- [ ] 未读数量徽章
  - [ ] 会话列表未读数
  - [ ] 顶部导航栏总未读数
  - [ ] 浏览器标题栏未读数

- [ ] 消息提示音
  - [ ] 新消息提示音
  - [ ] 静音开关

## 五、用户体验优化

### 5.1 加载状态 ⭐ 中优先级

**需要实现**:
- [ ] 骨架屏
  - [ ] 会话列表骨架屏
  - [ ] 消息列表骨架屏
  - [ ] 用户列表骨架屏

- [ ] 加载动画
  - [ ] 按钮加载状态
  - [ ] 页面加载动画
  - [ ] 数据加载提示

### 5.2 错误处理 ⭐ 中优先级

**需要实现**:
- [ ] 错误提示
  - [ ] Toast 提示
  - [ ] 错误页面
  - [ ] 网络错误提示

- [ ] 重试机制
  - [ ] 消息发送失败重试
  - [ ] 文件上传失败重试
  - [ ] API 请求重试

### 5.3 响应式设计 ⭐ 中优先级

**需要实现**:
- [ ] 移动端适配
  - [ ] 侧边栏折叠
  - [ ] 触摸手势支持
  - [ ] 移动端导航

- [ ] 平板适配
  - [ ] 中等屏幕布局
  - [ ] 横屏/竖屏适配

## 六、性能优化

### 6.1 前端优化 ⭐ 低优先级

**需要实现**:
- [ ] 虚拟滚动
  - [ ] 消息列表虚拟滚动
  - [ ] 长列表优化

- [ ] 图片优化
  - [ ] 图片懒加载
  - [ ] 图片压缩
  - [ ] WebP 支持

- [ ] 代码分割
  - [ ] 路由懒加载
  - [ ] 组件按需加载

### 6.2 缓存策略 ⭐ 低优先级

**需要实现**:
- [ ] 本地缓存
  - [ ] 消息缓存
  - [ ] 用户信息缓存
  - [ ] 文件预览缓存

- [ ] Service Worker
  - [ ] 离线支持
  - [ ] 资源缓存

## 开发优先级顺序

### 第一阶段（核心功能）⭐⭐⭐
1. 统一聊天界面布局
2. 好友管理（添加/列表/聊天）
3. 私聊消息（发送/接收/展示）
4. WebSocket 实时通信

### 第二阶段（群聊功能）⭐⭐
5. 群聊管理（创建/列表）
6. 群聊消息
7. 群成员管理
8. 群公告/邀请码

### 第三阶段（文件和视频）⭐⭐
9. 文件上传/下载（分片上传）
10. WebRTC 视频通话
11. 屏幕共享

### 第四阶段（完善体验）⭐
12. 个人资料编辑
13. 设置页面
14. 通知系统
15. 响应式设计

## 技术栈对标

### 线上版本使用的技术
- 前端框架: React
- UI 库: 可能是 Ant Design 或类似
- 状态管理: Redux/Zustand
- WebSocket: 原生 WebSocket
- WebRTC: 原生 WebRTC API

### 当前项目技术栈
- ✅ React + TypeScript
- ✅ Vite
- ✅ shadcn/ui（更现代）
- ✅ Zustand（更轻量）
- ✅ Framer Motion（动画）
- ✅ Tailwind CSS v4
- ✅ Lucide React（图标）

## 开发建议

### 1. 组件化开发
- 创建通用组件（MessageBubble/UserAvatar/FileCard等）
- 保持组件单一职责
- 复用性优先

### 2. 状态管理
- 已有 `authStore`，继续添加：
  - `chatStore` - 聊天相关状态
  - `friendStore` - 好友相关状态
  - `groupStore` - 群聊相关状态
  - `wsStore` - WebSocket 连接状态

### 3. API 调用规范
- 使用已实现的 API 模块（`src/api/*`）
- 统一错误处理
- 添加 loading 状态
- Toast 提示用户

### 4. 性能考虑
- 消息列表使用虚拟滚动（`react-window`）
- 图片使用懒加载
- 防抖/节流优化搜索和滚动

### 5. 测试
- 对照线上版本功能一一测试
- 测试各种边界情况
- 性能测试（大量消息/文件）

## 下一步行动

1. **立即开始**: 创建统一聊天界面布局
2. **并行开发**: 好友列表 + 私聊消息
3. **持续对标**: 经常访问线上版本确保功能一致
4. **快速迭代**: 优先实现核心功能，后期完善细节

---

**参考**: https://web.huanvae.cn/
**更新时间**: 2024-12-11
**当前状态**: API 接口层已完成 ✅，开始 UI 开发 🚀
